<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>
  
  <title>Manager_Home_Ept</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
    
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f7f9fc;
      display: flex;
      flex-direction: column;
    }

    .layout {
      display: flex;
      flex-direction: row;
      min-height: 100vh;
    }

    /* Left Sidebar */
    .sidebar {
      background-color: #fff;
      width: 240px;
      padding: 20px;
      border-right: 1px solid #ccc;
      display: none;
      flex-shrink: 0;
    }

    .sidebar h3 {
      margin-top: 0;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar li {
      margin: 15px 0;
    }

    .sidebar a {
      text-decoration: none;
      color: #007bff;
      font-weight: 500;
    }

    /* Main content area */
    .main-content {
      flex: 1;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

   .tasks {
     display: grid;
     grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
     gap: 12px;
     margin-bottom: 24px;
    }


    .task-card {           /* new */
  background: #fff;
  border-left: 6px solid #ffff;
  padding: 13px 4px 12px 4px;
  border-radius: 10px;
  min-width: 0;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.task-card h3 {
  font-size: 1rem;      
  margin: 0 0 6px 0;
  font-weight: 600;
}

.task-card i {
  font-size: 1.1rem;   
  display: block;
  margin-bottom: 3px;
}


.task-card:hover,
.task-card.green:hover,   
.task-card.orange:hover,
.task-card.red:hover {
  box-shadow: 0 4px 16px rgb(13 110 253 / 61%);
}

.task-card {
  font-size: 0.95rem;   
}

    .progress-section,
    .chart-section {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .progress-bar {
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar-inner {
      background: #007bff;
      height: 10px;
      width: 71.1%;
    }

    #taskChart {
      max-width: 140px;
      max-height: 140px;
      width: 100%;
      height: auto;
      margin: auto;
      display: block;
    }

    /* Bottom nav for mobile */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: #fff;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #ccc;
      padding: 10px 0;
    }

    .bottom-nav a {
      text-align: center;
      color: #333;
      text-decoration: none;
      font-size: 12px;
    }

    .bottom-nav i {
      font-size: 20px;
      display: block;
      margin-bottom: 4px;
    }

    .bottom-nav a:hover {
      color: #007bff;
      transform: scale(1.1);
    }

    /* Graph Icon Animation */
    .graph-icon {
      display: flex;
      gap: 4px;
      height: 20px;
      margin-bottom: 4px;
    }

    .graph-icon .bar {
      width: 4px;
      background: #007bff;
      border-radius: 2px;
      animation: barWave 1s infinite ease-in-out;
    }

    .bar1 {
      animation-delay: 0s;
    }
    .bar2 {
      animation-delay: 0.5s;
    }
    .bar3 {
      animation-delay: 1s;
    }

    @keyframes barWave {
      0% { height: 5px; }
      25% { height: 20px; }
      50% { height: 5px; }
      75% { height: 20px; }
      100% { height: 5px; }
    }

    /* Show sidebar on large screens */
    .main-content {
      padding: 20px;
      padding-bottom: 70px; 
    }

    /* Mobile menu button */
    .menu-btn {
      display: inline-block;
      background: none;
      border: none;
      font-size: 24px;
      margin-right: 15px;
    }

    /* Mobile sidebar overlay */
    .sidebar-mobile {
      display: block;
      position: fixed;
      top: 0;
      left: -250px;
      width: 240px;
      height: 100%;
      background: #fff;
      border-right: 1px solid #ccc;
      padding: 20px;
      transition: left 0.3s ease;
      z-index: 1000;
    }

    .sidebar-mobile.active {
      left: 0;
    }

    @media (max-width: 991px) {
      .sidebar {
        display: none;
      }

      .bottom-nav {
        display: flex;
      }
    }

    .summary-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 30px;
    }

    .progress-section,
    .chart-section {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      flex: 1;
    }

    /* Show side by side on wider screens */
    @media (min-width: 768px) {
      .summary-section {
        flex-direction: row;
      }
    }

    header {
      background-color: #dedbfa;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    header img {
      height: 31px;
    }

    header h1 {
      margin: 0;
      font-size: 18px;
    }

    header a {
      text-decoration: none;
      color: #007bff;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px 20px;
      background-color: #f6f8fb;
    }

    .dashboard-header h2 {
      font-size: 24px;
      margin: 0;
    }

    .header-buttons-horizontal {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .header-buttons-horizontal button {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-primary {
      background-color: #2962ff;
      color: #fff;
      border: none;
    }

    .btn-outline {
      background-color: #fff;
      color: #000;
      border: 1px solid #ccc;
    }

    /* Responsive layout for mobile */
    @media (max-width: 600px) {
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-buttons-horizontal {
        margin-top: 10px;
        width: 100%;
        flex-direction: column;
      }

      .header-buttons-horizontal button {
        width: 100%;
        box-sizing: border-box;
      }
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .popup-form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 53rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .popup-form h3 {
      margin-top: 0;
    }

    .popup-form input,
    .popup-form select,
    .popup-form textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    .popup-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .popup-buttons button {
      flex: 1;
    }

    .card {
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      padding: 16px;
      background-color: white;
      max-width: 400px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin: auto;
      font-family: Arial, sans-serif;
    }

    .card h3 {
      margin-bottom: 12px;
      font-size: 16px;
      color: #333;
      font-weight: bold;
    }

    .team-progress .team-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .team-row span {
      flex: 1 1 100px;
      font-weight: 600;
      font-size: 14px;
    }

    .percent {
      width: 40px;
      text-align: right;
      font-size: 13px;
    }

    .progress-bar {
      flex: 1 1 auto;
      height: 8px;
      background-color: #ddd;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .fill {
      height: 100%;
      border-radius: 10px;
    }

    .fill.blue {
      background-color: #1e90ff;
    }

    .fill.orange {
      background-color: #ffa500;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .card {
        padding: 12px;
      }

      .team-progress .team-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .progress-bar {
        width: 100%;
        margin: 4px 0;
      }

      .percent {
        align-self: flex-end;
      }
    }

    .row-cards {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: flex-start;
      margin-top: 20px;
    }

    .row-cards .task-card.orange {
      flex: 0 0 200px;
      min-width: 160px;
    }

    .row-cards .card {
      flex: 1;
      min-width: 260px;
    }

    .row-cards .card,
    .row-cards .task-card.orange {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    @media (max-width: 600px) {
      .row-cards {
        flex-direction: column;
      }

      .row-cards .task-card.orange,
      .row-cards .card {
        flex: 1 1 100%;
      }
    }

    body, html {
      background: #f6f8fb;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    /* Desktop row flex layout */
    .dashboard-row {
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      gap: 3.3vw;
      margin: 24px 0 0 0;
      width: 100%;
    }

    /* Overdue Stat Card */
    .stat-card.stat-overdue {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(40,60,80,0.06);
      padding: 32px 24px 20px 24px;
      min-width: 220px;
      min-height: 150px;
      text-align: left;
      margin-left: 12px;
    }
    .stat-number {
      font-size: 2em;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .stat-desc {
      font-size: 1.1em;
      color: #222;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .icon-hourglass {
      width: 20px;
      height: 20px;
      vertical-align: middle;
    }

    /* Completion Card (right side) */
    .completion-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(40,60,80,0.08);
      padding: 24px 30px 18px 30px;
      min-width: 370px;
      min-height: 200px;
      margin-left:/*  0px; */ -1px;
      flex: 1.5;
    }
    .completion-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 18px;
       margin-top:13px; 
      color: #444;
    }
    .completion-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .completion-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .team-name {
      flex: 2;
      font-weight: 600;
      color: #222;
      font-size: 1.03em;
    }
    .completion-bar {
      background: #e0e0e0;
      border-radius: 8px;
      width: 110px;
      height: 10px;
      position: relative;
      margin: 0 8px;
      flex: 2.2;
      overflow: hidden;
    }
    .bar-inner {
      height: 100%;
      border-radius: 8px;
      background: #2196f3;
      transition: width 0.5s;
    }
    .bar-inner.goal {
      background: #ffb300;
    }
    .percent {
      flex: 1;
      font-weight: 700;
      color: #222;
      text-align: right;
    }

    /* Responsive: on mobile switch to column */
    @media (max-width: 900px) {
      .dashboard-row {
        flex-direction: column;
        gap: 18px;
        align-items: stretch;
      }
      .stat-card.stat-overdue,
      .completion-card {
        min-width: 0;
        margin: 0 auto 0 auto;
        width: 90vw;
        box-sizing: border-box;
      }
      .completion-card { padding: 18px 8vw 12px 8vw; }
    }

    /* Layout rows with 2 columns */
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
      }
    }

    .popup-buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    /* Each form group (label + input) */
    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* Full width for fields like Remarks */
    .form-group.full-width {
      flex: 1 1 100%;
    }

    /* Inputs, selects, textareas styles */
    input, select, textarea {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 4px;
      box-sizing: border-box;
    }

    /* Labels */
    label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    /* Button styles */
    .popup-buttons {
      display: flex;
      justify-content: flex-start;
      gap: 15px;
      margin-top: 20px;
      width: 0rem;
      margin-left: 13.5rem;
    }

    .btn-submit, .btn-back {
      padding: 5px 70px;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-submit {
      background-color:#007bff; 
      color: #fff;
    }
    
      .btn-submit:hover {
      background-color:#3734ad; 
      color: #fff;
    }

    .btn-back {
      background-color: #f15a2d;
      color: #fff;
    }
    
    .btn-back:hover {
      background-color: #da0d14;
      color: #fff;
    }

    /* Responsive tweak for small screens */
    @media (max-width: 600px) {
      .form-row {
        flex-direction: column;
      }
    }
	
    .suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 10;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 150px;
      overflow-y: auto;
    }

    .suggestions-dropdown div {
      padding: 8px 12px;
      cursor: pointer;
    }

    .suggestions-dropdown div:hover {
      background-color: #f0f0f0;
    }

    .profile-container {
      position: relative;
      display: inline-block;
    }

    .profile-icon {
      cursor: pointer;
      font-size: 20px;
    }

    .dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 30px;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 1000;
      min-width: 182px;
    }

    .dropdown a {
      display: block;
      padding: 10px;
      color: #1e40af;
      text-decoration: none;
      font-weight: bold;
    }

    .dropdown a:hover {
      background-color: #f0f0f0;
    }

    .toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 99999; /* Make sure it's higher than your popup */
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}


    .toast {
      position: relative;
      min-width: 250px;
      max-width: 350px;
      background-color: white;
      color: #333;
      padding: 12px 40px 12px 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      animation: fadeInOut 5s forwards;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 0.9rem;
      line-height: 1.4;
      border-left: 4px solid transparent;
    }

    .toast.success {
      border-left-color: #4caf50;
    }

    .toast.error {
      border-left-color: #f44336;
    }

    .toast.info {
      border-left-color: #2196f3;
    }

    .toast-title {
      font-weight: bold;
      margin-bottom: 2px;
      color: #333;
    }

    .toast-message {
      color: #666;
    }

    .toast-close {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1rem;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }
    
   
  .popup-overlay {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  
  

  .popup-box {
  position: relative;
  background: #fff;
  padding: 25px 30px;
  border-radius: 8px;
  width: 350px;
  max-width: 90%;
  box-shadow: 0 2px 12px rgba(0,0,0,0.3);
  text-align: center;
}

/* Top-right corner X icon */
.close-btn {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 22px;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  transition: color 0.2s;
}

.close-btn:hover {
  color: #d33;
}


  .popup-box h2 {
    margin-bottom: 20px;
    font-size: 20px;
  }

  .popup-box label {
    display: block;
    margin: 10px 0 5px;
    text-align: left;
  }

  .popup-box input {
    width: 100%;
    padding: 8px;
    font-size: 14px;
    margin-bottom: 10px;
  }

  .popup-actions {
    margin-top: 15px;
    display: flex;
    justify-content: space-between;
  }

  .popup-actions button {
    padding: 7px 15px;
    border: none;
    border-radius: 4px;
    background-color: #007bff;
    color: white;
    cursor: pointer;
    margin-left: 110px;
  }

  .popup-actions button:nth-child(2) {
    background-color: #dc3545;
  }
  
  
  
    /* Add to your <style> or main CSS */

.custom-menu-bar {
  background: #fff;
  margin: 18px 26px 20px 26px;
  border-radius: 12px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  padding: 0.4rem 2.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  min-height: 54px;
  position: relative;
  z-index: 10;
  margin-left: 20px;
    margin-right: 20px;
}
.custom-menu-bar .menu-bar-left ul {
  display: flex;
  gap: 24px;
  margin: 0;
  padding: 0;
  align-items: center;
  list-style: none;
}
.custom-menu-bar li {
  position: relative;
  display: flex;
  align-items: center;
}
.custom-menu-bar a {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 500;
  color: #61677c;
  font-size: 1.07rem;
  text-decoration: none;
  padding: 7px 18px;
  border-radius: 8px;
  transition: background 0.1s, color 0.1s, box-shadow 0.16s;
}
.custom-menu-bar li.active > a,
.custom-menu-bar a:hover {
  background: linear-gradient(90deg, #46e45a 0%, #3ad17e 100%);
  color: #fff !important;
  box-shadow: 0 2px 10px rgba(72,255,134,0.11);
}
.custom-menu-bar i {
  font-size: 1rem;
  color: inherit;
}
.custom-menu-bar .fa-chevron-down {
  font-size: 0.88em;
  margin-left: 4px;
}
.custom-menu-bar .has-dropdown .dropdown-menu {
  display: none;
  position: absolute;
  top: 105%;
  left: 0;
  background: #fff;
  min-width: 180px;
  border-radius: 10px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.10);
  z-index: 20;
  padding: 0.5rem 0;
}
.custom-menu-bar .has-dropdown.open .dropdown-menu {
  display: block;
}
.custom-menu-bar .dropdown-menu li {
  width: 100%;
}
.custom-menu-bar .dropdown-menu a {
  color: #4a5568;
  background: none;
  font-size: 0.99rem;
  padding: 9px 22px;
  border-radius: 0;
}
.custom-menu-bar .dropdown-menu a:hover {
  background: #f7f9fc;
  color: #1e40af;
}
.raise-incident-btn {
 background: #ff9c07ba;
    color: #fff;
    font-weight: bold;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    padding: 6px 10px 7px 8px;
    box-shadow: 0 2px 18px 0 #ff9c07a6;
    cursor: pointer;
    letter-spacing: 0.03em;
    position: relative;
    transition: background 0.15s, box-shadow 0.15s;
    margin-left: 10px;
    display: flex
;
    align-items: center;
    gap: 8px;
}
.raise-incident-btn:hover,
.raise-incident-btn:focus {
background: #ff9c07ba;
    box-shadow: 0 4px 24px 0 #28a745;
}
.badge-new {
position: absolute;
    top: -7px;
    right: -7px;
    background: #90caf9c2;
    color: #fff;
    font-size: 0.5rem;
    font-weight: 700;
    border-radius: 8px;
    padding: 1px 5px;
    box-shadow: 0 2px 7px #90caf985;
    z-index: 1;
    letter-spacing: 0.01em;
}
@media (max-width: 900px) {
  .custom-menu-bar {
    padding: 0.4rem 0.8rem;
  }
  .custom-menu-bar .menu-bar-left ul {
    gap: 8px;
  }
}
@media (max-width: 600px) {

  .custom-menu-bar {
        flex-direction: column;
        align-items: stretch;
        padding: 0.4rem 0.2rem;
        margin: 8px 2px 0px 2px;
        min-height: 46px;
        border-radius: 7px;
        width: 90vm;
        margin-left: 17px;
        margin-right: 18px;
    }
  .custom-menu-bar .menu-bar-left ul {
    gap: 2px;
  }
  .raise-incident-btn {
    font-size: 0.99rem;
    padding: 10px 12px;
    margin: 8px 0 0 12px;
  }
}
    
   .chart-blink-wrap {
  display: inline-block;
  position: relative;
  font-size: inherit;
  width: 1em;
  height: 1em;
}

.chart-blink-wrap .fa-chart-simple {
  position: relative;
  z-index: 1;
  color: #61677c;
}

/* Overlay blinking bars */
.chart-blink-bar {
  position: absolute;
  bottom: 0.16em; 
  width: 0.16em;
  height: 0.45em;
  border-radius: 0.08em;
  opacity: 0;
  z-index: 2;
  pointer-events: none;
  background: #ffff;
 
}

.chart-blink-bar.bar1 {
  left: 0.08em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0s;
}
.chart-blink-bar.bar2 {
  left: 0.32em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0.4s;
}
.chart-blink-bar.bar3 {
  left: 0.60em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0.8s;
}

@keyframes blinkBarColor {
  0%, 100% { opacity: 0; }
  10%, 60% { opacity: 0.9; }
  61%, 99% { opacity: 0; }
} 
    
  .datatable-section {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.07);
      padding: 22px 18px 34px 18px;
      margin-top: 16px;
      margin-bottom: 24px;
      max-width: 100%;
      overflow-x: auto;
    }
    .datatable-section h4 {
      font-weight: 700;
      margin-bottom: 16px;
      color: #3734ad;
    }
    .custom-tabs {
      display: flex;
      border-bottom: 2px solid #eee;
      padding-left: 0;
      list-style: none;
      font-size: 1rem;
      font-weight: 600;
      background: none;
      margin-bottom: 0;
    }
    .custom-tabs li {
      cursor: pointer;
      padding: 13px 28px 10px 16px;
      color: #4b43c2;
      border-bottom: 3px solid transparent;
      background: none;
      transition: color 0.14s, border 0.14s;
    }
    .custom-tabs li.active {
      color: #283593 !important;
      border-bottom: 3px solid #283593 !important;
      font-weight: bold;
    }
    .custom-tabs li:not(.active):hover {
      background: #f6f8ff;
    }
    table.dataTable thead th {
      background: #e6eeff !important;
      color: #3734ad !important;
      font-weight: 700;
      font-size: 1.07rem;
      border-bottom: none;
    }
    table.dataTable tbody tr:nth-child(even) {
      background: #f6f8ff !important;
    }
    table.dataTable {
      border-radius: 10px;
      overflow: hidden;
      width: 100% !important;
    }
    table.dataTable th, table.dataTable td {
      padding: 12px 10px !important;
      font-size: 1.07rem;
    }  
    
    
/* Ensures horizontal scroll if table overflows */
.datatable-section {
  overflow-x: auto;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  padding: 22px 18px 34px 18px;
  margin-top: 22px;
  margin-bottom: 24px;
  width: 100%;
  max-width: 100vw;
}

/* DataTable base style */
table.display {
  border-collapse: separate !important;
  border-spacing: 0;
  width: 100% !important;
  background: #fff;
  margin-bottom: 0;
  border-radius: 10px;
  overflow: hidden;
  table-layout: auto;
}

/* Table header cell styling */
table.display th {
  background: #e6eeff !important;
  color: #3734ad !important;
  font-weight: 700;
  border-bottom: 2px solid #e0e0e0 !important;
  font-size: 1.07rem;
  padding: 10px 10px;
  text-align: left;
}

/* Table body cell styling */
table.display td {
  font-size: 1.05rem;
  padding: 10px 10px;
  border-bottom: 1px solid #f0f0f0;
  text-align: left;
  vertical-align: top;
  background: #fff;
  word-break: break-word;
  white-space: pre-line;
}

/* Zebra rows */
table.display tbody tr:nth-child(even) {
  background: #f6f8ff !important;
}

/* Specific column widths and alignment */
table.display th:nth-child(1), table.display td:nth-child(1) {
  width: 39px;
  min-width: 32px;
  max-width: 42px;
  text-align: center;
  font-family: 'Fira Mono', 'Consolas', monospace;
}
table.display th:nth-child(2), table.display td:nth-child(2) { 
  width: 170px;
  min-width: 130px;
  max-width: 220px;
}
table.display th:nth-child(3), table.display td:nth-child(3) { 
  width: 180px;
  min-width: 140px;
  max-width: 220px;
}
table.display th:nth-child(4), table.display td:nth-child(4) {
  width: 90px;
  min-width: 70px;
  max-width: 110px;
  text-align: center;
}
table.display th:nth-child(5), table.display td:nth-child(5) { 
  width: 110px;
  min-width: 90px;
  max-width: 120px;
  text-align: center;
}
table.display th:nth-child(6), table.display td:nth-child(6) { 
  width: 110px;
  min-width: 90px;
  max-width: 120px;
  text-align: center;
}
table.display th:nth-child(7), table.display td:nth-child(7) {
  width: 80px;
  min-width: 65px;
  max-width: 100px;
  text-align: center;
}
table.display th:nth-child(8), table.display td:nth-child(8) { 
  width: 100px;
  min-width: 85px;
  max-width: 110px;
  text-align: center;
}
table.display th:nth-child(9), table.display td:nth-child(9) { 
  width: 180px;
  min-width: 120px;
  max-width: 210px;
}
table.display th:nth-child(10), table.display td:nth-child(10) { 
  width: 230px;
  min-width: 140px;
  max-width: 350px;
}

/* Responsive: on small screens, allow scroll */
@media (max-width: 900px) {
  .datatable-section {
    padding: 8px 1vw 12px 1vw;
  }
  table.display th, table.display td {
    font-size: 0.92rem;
    padding: 7px 6px;
    min-width: 90px;
    max-width: 180px;
  }
  table.display th:nth-child(10),
  table.display td:nth-child(10) {
    max-width: 120px;
  }
}    
    /* Make DataTable font x-small */
table.display,
table.display th,
table.display td {
  font-size: small !important;
}
   
   header,
header * {
  color: #fff !important;           
  font-weight: bold !important;     
} 
  
.dropdown a,
.dropdown a i {
  color: #111 !important;
} 



/* Mobile view: screen width <= 768px */
@media (max-width: 768px) {
  .popup-form {
    width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 15px;
  }

  .form-row {
    flex-direction: column !important;
    gap: 10px;
  }

  .form-group {
    width: 100% !important;
    margin: 0 !important;
  }

  .form-group textarea,
  .form-group input,
  .form-group select {
    width: 100%;
  }

  .remarks-group {
    margin-left: 0 !important;
  }

  .popup-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .btn-submit,
  .btn-back {
    width: 100%;
  }
}


    /* mobile view */ 

@media (max-width: 768px) {
  .popup-buttons {
    width: 100% !important;
    margin-left: 0 !important;
    display: flex !important;        
    flex-direction: row !important;  
    justify-content: center !important;
    gap: 10px;
  }

  .btn-submit,
  .btn-back {
    width: 45% !important;          
    padding: 10px 0;
    font-size: 15px;
    text-align: center;
  }
  
}

@media (max-width: 768px) {
  #manager_name {
    width: 100% !important;
  }

 
  #remarks {
    width: 100% !important;
  }

  .form-group[style*="margin-left: -17rem"] {
    margin-left: 0 !important;
  }
}



</style>
    
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  <!-- Global Header -->
  <header style="background: linear-gradient(90deg, #77c1c9 0%, #7ce7508c 100%);padding: 1rem;display: flex;justify-content: space-between;align-items: center;margin-top: 0.1rem;position: relative;"> 
    <div style="display: flex; align-items: center; gap: 0.5rem;">
    <img src="/images/logo.png" alt="User Icon" style="width: 41px; height: 30px;">
    
    <div="" class="profile-container" style="">
      <i class="fa-solid fa-user-tie" style="color: #1e40af; font-size: 1.2rem;"></i>
      <span id="loggedInEmail" style="font-weight: normal;"></span>
    </div>
  <div class="profile-container">
  <i class="fas fa-bars" onclick="toggleDropdown()"></i>
  <div class="dropdown" id="profileDropdown">
    <a href="/ept/profile"><i class="fa fa-user"></i> Profile</a>
    <a href="#" id="addEmployeeBtn" style="cursor: pointer;"><i class="fa fa-plus"></i> Add Employee</a>
    <a href="/ept/emplsDetails"><i class="fas fa-users"></i> Employees</a>
    <a href="/" onclick="localStorage.clear();"><i class="fas fa-power-off"></i> Logout</a>
  </div>
</div>
  </header>
  
  <!-- Place this after your <header> and before <main class="main-content"> -->
<nav class="custom-menu-bar">
  <div class="menu-bar-left">
    <ul>
      <li class="has-dropdown" id="dashboardMenu">
        <a href="#" id="dashboardMenuLink">
  <i class="fa-solid fa-chart-simple"></i>
  Dashboard
  <i class="fa-solid fa-chevron-down chevron-icon"></i>
</a>
        <ul class="dropdown-menu">
          <li><a href="/ept/empscore"><i class="fa-solid fa-gauge"></i>Score Board</a></li>
          <li><a href="/ept/Pdashboard"><i class="fa-solid fa-chart-line"></i> Analytics</a></li>
        </ul>
      </li>
      <li>
        <a href="/ept/taskListView">
          <i class="fa-solid fa-list-check fa-color-list"></i>
          View Task List
        </a>
      </li>
      <li>
        <a href="/ept/storypoints">
         <span class="chart-blink-wrap">
  <i class="fa-solid fa-gem fa-rainbow"></i>
</span>
          Story Points
        </a>
      </li>
    </ul>
  </div>
 <div class="menu-bar-right">
    <div style="position: relative; display: inline-block;">
      <button class="raise-incident-btn" onclick="openTaskPopup()">
        + AddTask
      </button>
    <span class="badge-new">New</span>
    </div>
  </div>
</nav>


 <!-- Layout for Web -->
  <main class="main-content">
    <div class="tasks">
      <div class="task-card">
        <h3 id="totalTasks">0</h3>
        <i class="fa-solid fa-clipboard-check fa-bounce"></i> Team Tasks
      </div>
      <div class="task-card green">
        <h3 id="completedTasks">0</h3>
        <i class="fas fa-check fa-bounce"></i> Completed Tasks
      </div>
      <div class="task-card orange">
        <h3 id="InProgressTasks">0</h3>
        <i class="fa-solid fa-sync fa-spin"></i> In Progress
      </div>
      <div class="task-card red">
        <h3 id="notStartedTasks">0</h3>
        <i class="fas fa-hourglass-half fa-spin"></i> Not Started
      </div>
    </div> 
    
    
    <!-- DATATABLE SECTION: replaces Completion Request & Overdue cards -->
    <div class="datatable-section">
    
      <ul class="custom-tabs">
        <li id="tab-completion" class="active" onclick="showTab('completion')">Completion Request</li>
        <li id="tab-overdue" onclick="showTab('overdue')">Overdue</li>
        <li id="tab-blocked" onclick="showTab('blocked')">Blocked</li>
      </ul>
      
      
      <div id="table-completion" style="margin-top:18px;">
        <table id="completionRequestTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th>#</th>
              <th>Description</th>
              <th>Person</th>
              <th>Department</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Bottlenecks</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="table-overdue" style="display:none; margin-top:18px;">
        <table id="overdueTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th>#</th>
              <th>Description</th>
              <th>Person</th>
              <th>Department</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Priority</th>
              <th>Status</th>             
              <th>Bottlenecks</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
         <div id="table-blocked" style="display:none; margin-top:18px;">
        <table id="blockedTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th>#</th>
              <th>Description</th>
              <th>Person</th>
              <th>Department</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Priority</th>
              <th>Status</th>             
              <th>Bottlenecks</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
   
      <div class="completion-card">
        <h6 class="completion-title">Team Task Completion</h6>
        <div class="completion-list">
         <!-- Dynamically populated by JavaScript -->
        </div>
      </div>
  </main> 

  <!-- Add Task Popup Form -->
  <div id="addTaskPopup" class="popup-overlay" style="display: none;">
    <div class="popup-form">
      <h3>Add New Task</h3>
      <form id="taskForm">
      
        <!-- Row 1: Description, Department, Area -->
        <div class="form-row">       
          <div class="form-group">
            <label for="description">Description:</label>
            <input type="text" id="description" name="description" placeholder="Enter description" required>
          </div>
        
          <div class="form-group">
            <label for="area">Area:</label>
            <input type="text" id="area" name="area" placeholder="Enter area">
          </div>
          
           <div class="form-group">
            <label for="sub_area">Sub-Area:</label>
            <input type="text" id="sub_area" name="sub_area" placeholder="Enter sub-area" >
          </div>
          
        </div>
                  
        
        <!-- Row 2: Sub-Area, Person, Start-Date -->
        <div class="form-row">
        
          <div class="form-group" style="position: relative;">
            <label for="person">Person:</label>
            <input type="text" id="person" name="person" placeholder="Search by name" autocomplete="off" required>
            <div id="person-suggestions" class="suggestions-dropdown"></div>
          </div>
          
          <div class="form-group">
            <label for="department">Department:</label>
           
            <input type="text" id="department" name="department" placeholder="Department" readonly required>
          </div>
          <div class="form-group">
            <label for="start_date">Start-Date:</label>
            <input type="date" id="start_date" name="start_date" required>
          </div>
        </div>
        <!-- Row 3: End-Date, Status, Priority -->
        <div class="form-row">
          <div class="form-group">
            <label for="end_date">End-Date:</label>
            <input type="date" id="end_date" name="end_date" required>
          </div>
          <div class="form-group">
            <label for="status">Status:</label>
           
           <input type="text" id="status" name="status" value="Not Started" readonly required>
            
          </div>
          <div class="form-group">
            <label for="priority">Priority:</label>
            <select id="priority" name="priority" required>
              <option value="">Select Priority</option>
              <option>High</option>
              <option>Medium</option>
              <option>Low</option>
            </select>
          </div>
        </div>
        <!-- Row 4: Remarks --> 
       
        <div class="form-row">                           
       <div class="form-group">
            <label for="manager_name">Manager:</label>
           <input type="text" id="manager_name" name="manager_name"  style="  width: 16rem;"  required  readonly>   
        </div> 
        

     <div class="form-group" style=" margin-left: -17rem;"> 
         <!-- <div class="form-group remarks-group"> -->
         
            <label for="remarks">Remarks:</label>
            <textarea id="remarks" name="remarks" placeholder="Additional remarks&#10;Note: Don't add too much content here."  rows="3"></textarea>
          </div>
        </div>
        <!-- Buttons -->
        <div class="popup-buttons">
          <!-- <button type="submit" class="btn-submit" onclick="submitTask(event)">Submit</button> -->
          <button type="submit" class="btn-submit" id="submitTaskBtn" onclick="submitTask(event)">Add</button>
          
          <button type="button" class="btn-back" onclick="closeTaskPopup()">&laquo; Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
 <div id="addEmployeePopup" class="popup-overlay">
  <div class="popup-box">
    <i class="fas fa-times close-btn" onclick="closePopup()"></i>
    <h2>Add Employee</h2>
    <form id="addEmployeeForm">
      <label>Email:</label>
      <input type="email" id="empEmail" placeholder="Enter Company Email" required />

      <label>Role:</label>
      <!-- <input type="text" id="empRole" placeholder="Enter Role" required /> -->
      <input type="text" id="empRole" name="empRole" value="Employee" readonly required>
      <label>Department:</label>
      <input type="text" id="empDept" placeholder="Enter Department" required />

      <div class="popup-actions">
        <button type="submit">Add</button>
      </div>
    </form>
  </div>
</div>

  
  
  <script>
    // Toast notification function
    function showToast(type, title, message) {
      const toastContainer = document.getElementById("toast-container");
      const toast = document.createElement("div");
      toast.className = `toast ${type}`;
      const toastTitle = document.createElement("div");
      toastTitle.className = "toast-title";
     // toastTitle.textContent = title;
      toastTitle.innerHTML = title;
      const toastMessage = document.createElement("div");
      toastMessage.className = "toast-message";
      toastMessage.textContent = message;
      const closeButton = document.createElement("button");
      closeButton.className = "toast-close";
     // closeButton.textContent = "×";
       closeButton.innerHTML = '<i class="fas fa-times"></i>';
      closeButton.onclick = () => {
        toast.style.animation = "none";
        toast.remove();
      };
      toast.appendChild(toastTitle);
      toast.appendChild(toastMessage);
      toast.appendChild(closeButton);
      toastContainer.appendChild(toast);
      setTimeout(() => {
        if (toast.parentNode) {
          toast.remove();
        }
      }, 2000);
    }

    
    // Toggle dropdown visibility
    function toggleDropdown() {
      const dropdown = document.getElementById("profileDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }
    
   // Close dropdown when clicking outside
    document.addEventListener("click", function(event) {
      const dropdown = document.getElementById("profileDropdown");
      const toggleIcon = document.querySelector(".fa-bars");
      
      if (
    	      dropdown.style.display === "block" &&
    	      !dropdown.contains(event.target) &&
    	      !toggleIcon.contains(event.target)
    	    ) {
    	      dropdown.style.display = "none";
    	    }
    	  });

    // Open Add Employee popup and close dropdown
    document.getElementById("addEmployeeBtn").addEventListener("click", function (e) {
      e.preventDefault();
      document.getElementById("addEmployeePopup").style.display = "flex";

      // Close the dropdown
      document.getElementById("profileDropdown").style.display = "none";
    });

    // Close popup
    function closePopup() {
      document.getElementById("addEmployeePopup").style.display = "none";
    }
 
    // Function to display the logged-in email
    function displayLoggedInEmail() {
      const loggedInEmail = localStorage.getItem("EmpEmail") || "Unknown User";
      document.getElementById("loggedInEmail").textContent = loggedInEmail;
    }

    // Call the function to display the email when the page loads
    displayLoggedInEmail();

    let tasks = [];

    async function fetchTasks() {
      try {
        const res = await fetch(`/api/manager/tasks/${localStorage.getItem("EmpEmail")}`);
        tasks = await res.json();
        const validTasks = tasks.filter(t => t && t.id != null);

        // Calculate task stats
        const totalTasks = validTasks.length;
        const completedTasks = validTasks.filter(task => task.status === "Completed").length;
        const notStartedTasks = validTasks.filter(task => task.status === "Not Started").length;
        const inProgressTasks = validTasks.filter(task => task.status === "In Progress").length;
      
        
        // Update task cards
        document.querySelector('.task-card h3').textContent = totalTasks;
        document.querySelectorAll('.task-card')[1].querySelector('h3').textContent = completedTasks;
        document.querySelectorAll('.task-card')[2].querySelector('h3').textContent = inProgressTasks;
        document.querySelectorAll('.task-card')[3].querySelector('h3').textContent = notStartedTasks; 
     
        // Calculate and render team task completion
        renderTeamCompletion(validTasks);

        renderTasks(validTasks);
      } catch (err) {
        console.error("Error fetching tasks:", err);
        showToast('error', '<i class="fas fa-xmark" style="color: red; "></i> Fetch Error', 'Failed to load tasks');
      }
    }

    function renderTasks(taskList) {
      const container = document.getElementById("task-container");
    }
    
    function renderTeamCompletion(tasks) {
    	  const completionList = document.querySelector('.completion-list');
    	  completionList.innerHTML = ''; // Clear existing

    	  // Dynamically get unique departments from task data
    	  const departments = [...new Set(tasks.map(task => task.department).filter(Boolean))];

    	  // For each department, calculate and render completion
    	  departments.forEach(dept => {
    	    const deptTasks = tasks.filter(task => task.department === dept);
    	    const totalDeptTasks = deptTasks.length;
    	    const completedDeptTasks = deptTasks.filter(task => task.status === "Completed").length;
    	    const completionPercentage = totalDeptTasks > 0 
    	      ? ((completedDeptTasks / totalDeptTasks) * 100).toFixed(1) 
    	      : 0;

    	    const row = document.createElement('div');
    	    row.className = 'completion-row';
    	    row.innerHTML = `
    	      <!-- <div class="team-name">${dept} team</div> -->
    	      <div class="team-name">${dept}</div>
    	      <div class="completion-bar">
    	        <div class="bar-inner" style="width:${completionPercentage}%"></div>
    	      </div>
    	      <div class="percent">${completionPercentage}%</div>
    	    `;
    	    completionList.appendChild(row);
    	  });

    	  // Weekly Goals
    	  const today = new Date();
    	  const startOfWeek = new Date(today);
    	  startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
    	  const endOfWeek = new Date(today);
    	  endOfWeek.setDate(today.getDate() - today.getDay() + 6); // Saturday

    	  const weeklyTasks = tasks.filter(task => {
    	    const endDate = new Date(task.end_date);
    	    return endDate >= startOfWeek && endDate <= endOfWeek;
    	  });
    	  const totalWeeklyTasks = weeklyTasks.length;
    	  const completedWeeklyTasks = weeklyTasks.filter(task => task.status === "Completed").length;
    	  const weeklyPercentage = totalWeeklyTasks > 0 
    	    ? ((completedWeeklyTasks / totalWeeklyTasks) * 100).toFixed(1) 
    	    : 0;

    	  const weeklyRow = document.createElement('div');
    	  weeklyRow.className = 'completion-row';
    	  weeklyRow.innerHTML = `
    	    <div class="team-name">Weekly Goals</div>
    	    <div class="completion-bar">
    	      <div class="bar-inner goal" style="width:${weeklyPercentage}%; background:#ffb300;"></div>
    	    </div>
    	    <div class="percent">${weeklyPercentage}%</div>
    	  `;
    	  completionList.appendChild(weeklyRow);
    	}


    function startAutoRefresh() {
      fetchTasks(); 
      setInterval(fetchTasks, 5000); // Refresh every 5 sec
    }

    startAutoRefresh();
    
  
    async function submitTask(event) {
    	  event.preventDefault();

    	  const form = document.getElementById('taskForm');
    	  const submitBtn = document.getElementById('submitTaskBtn'); // safest with ID

    	  if (!form.checkValidity()) {
    	    form.reportValidity();
    	    return;
    	  }
    	  
    	  const startDate = new Date(document.getElementById('start_date').value);
    	  const endDate = new Date(document.getElementById('end_date').value);

    	  if (startDate > endDate) {
    	    showToast( "error", '<i class="fas fa-xmark" style="color: red;"></i> Invalid Dates', 'Start date cannot be after end date.');
    	    return;
    	  }

    	  // Disable button and show loading text
    	  submitBtn.disabled = true;
    	  submitBtn.innerText = 'Assigning...';

    	  const formData = new FormData(form);
    	  const taskData = {};
    	  formData.forEach((value, key) => {
    	    taskData[key] = value;
    	  });

    	  try {
    	    const response = await fetch('/api/manager/taskasign', {
    	      method: 'POST',
    	      headers: {
    	        'Content-Type': 'application/json'
    	      },
    	      body: JSON.stringify(taskData)
    	    });

    	    if (!response.ok) {
    	      const errorText = await response.text();
    	      throw new Error(errorText || 'Failed to assign task');
    	    }

    	    closeTaskPopup();
    	    showToast("success",'<i class="fas fa-check" style="color: green;"></i> Success!','Task assigned successfully.');
    	    form.reset();
    	  } catch (error) {
    	    console.error('Error:', error);
    	    showToast("error",'<i class="fas fa-xmark" style="color: red;"></i> Failed!', 'Failed to assign task.');
    	  } finally {
    	    submitBtn.disabled = false;
    	    submitBtn.innerText = 'Submit';
    	  }
    	}

 
 function openTaskPopup() {
	  const popup = document.getElementById('addTaskPopup');
	  popup.style.display = 'flex';

	  const empEmail = localStorage.getItem('EmpEmail');
	  if (empEmail) {
	    document.getElementById('person').value = ''; // clear previous value if needed
	    document.getElementById('manager_name').value = empEmail; // 👈 Fill Manager with logged-in employee email
	  }
	}

    function closeTaskPopup() {
      document.getElementById('addTaskPopup').style.display = 'none';
    }
    

 let employeeEmails = [];

 async function fetchEmployeeEmails() {
   try {
     const response = await fetch(`/api/manager/employees/${localStorage.getItem("EmpEmail")}`);
     const users = await response.json();
     employeeEmails = users
       .filter(user => user.role.toLowerCase() === 'employee')
       .map(user => ({
         email: user.email,
         name: user.name,
         department: user.department 
       }));
   } catch (err) {
     console.error('Error fetching users:', err);
     showToast("error", '<i class="fas fa-xmark" style="color: red;"></i> Error', 'Failed to load employee data.');
   }
 }

 fetchEmployeeEmails();

 const personInput = document.getElementById("person");
 const suggestionBox = document.getElementById("person-suggestions");
 const departmentSelect = document.getElementById("department"); 

 personInput.addEventListener("input", function () {
   const query = this.value.toLowerCase();
   suggestionBox.innerHTML = "";

   if (query.length === 0) {
     suggestionBox.style.display = "none";
     return;
   }

   const suggestions = employeeEmails.filter(emp =>
     emp.name.toLowerCase().includes(query) || emp.email.toLowerCase().includes(query)
   );

   if (suggestions.length === 0) {
     suggestionBox.style.display = "none";
     return;
   }

   suggestions.forEach(emp => {
     const div = document.createElement("div");
     div.textContent = `${emp.name} (${emp.email})`;
     div.classList.add("suggestion-item");
     div.addEventListener("click", function () {
       personInput.value = emp.email;
       suggestionBox.style.display = "none";

       // Set department field
       fillDepartment(emp.department);
     });
     suggestionBox.appendChild(div);
   });

   suggestionBox.style.display = "block";
 });

 document.addEventListener("click", function (event) {
   if (!personInput.contains(event.target) && !suggestionBox.contains(event.target)) {
     suggestionBox.style.display = "none";
   }
 });

 // Fill department dropdown
 function fillDepartment(dept) {
	 departmentSelect.value = dept;
 }

 function toggleDropdown() {
   const dropdown = document.getElementById("profileDropdown");
   dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
 }

    
 // Add this after the DOM is loaded (before </body> or in a script block)
    document.querySelectorAll('.custom-menu-bar li.has-dropdown > a').forEach(function(menuLink) {
  menuLink.addEventListener('click', function(e) {
    e.preventDefault();
    // Close other open dropdowns and reset their chevrons
    document.querySelectorAll('.custom-menu-bar li.has-dropdown').forEach(function(li) {
      if (li !== menuLink.parentElement) {
        li.classList.remove('open');
        const chevron = li.querySelector('.chevron-icon');
        if (chevron) {
          chevron.classList.remove('fa-chevron-up');
          chevron.classList.add('fa-chevron-down');
        }
      }
    });
    // Toggle this dropdown
    menuLink.parentElement.classList.toggle('open');
    const chevron = menuLink.querySelector('.chevron-icon');
    if (chevron) {
      chevron.classList.toggle('fa-chevron-down');
      chevron.classList.toggle('fa-chevron-up');
    }
  });
});
 
 // Optional: close dropdown when clicking outside and reset chevron
    document.addEventListener('click', function(e) {
      document.querySelectorAll('.custom-menu-bar li.has-dropdown').forEach(function(li) {
        if (!e.target.closest('.custom-menu-bar li.has-dropdown')) {
          li.classList.remove('open');
          const chevron = li.querySelector('.chevron-icon');
          if (chevron) {
            chevron.classList.remove('fa-chevron-up');
            chevron.classList.add('fa-chevron-down');
          }
        }
      });
    });
     
     
    
  document.addEventListener("DOMContentLoaded", function () {
    fetchTasksAndRender();

    window.showTab = function (tab) {
    	  // Remove active from all tabs
    	  document.getElementById("tab-completion").classList.remove("active");
    	  document.getElementById("tab-overdue").classList.remove("active");
    	  document.getElementById("tab-blocked").classList.remove("active");
    	  // Hide all tables
    	  document.getElementById("table-completion").style.display = "none";
    	  document.getElementById("table-overdue").style.display = "none";
    	  document.getElementById("table-blocked").style.display = "none";
    	  // Show selected
    	  document.getElementById("tab-" + tab).classList.add("active");
    	  document.getElementById("table-" + tab).style.display = "block";
    	};
  });

  function fetchTasksAndRender() {
    fetch(`/api/manager/tasks/${localStorage.getItem("EmpEmail")}`)
      .then(response => response.json())
      .then(data => {
        const today = new Date().toISOString().split('T')[0];

        const completionTasks = data.filter(task =>
          task.status === "Completion Request" 
        );

         const overdueTasks = data.filter(task =>
          task.status !== "Completed" &&  task.status !== "Completion Request" &&
          task.end_date && task.end_date < today
        ); 
        
         const blockTasks = data.filter(task =>
         task.status === "Blocked" 
       );
        

        renderTable("completionRequestTable", completionTasks);
        renderTable("overdueTable", overdueTasks);
        renderTable("blockedTable", blockTasks);
      })
      .catch(error => console.error("Error fetching tasks:", error));
  }

  function renderTable(tableId, tasks) {
	  const tbody = document.querySelector(`#${tableId} tbody`);
	  tbody.innerHTML = "";

	  tasks.forEach((task, index) => {
	    const row = document.createElement("tr");
	    row.innerHTML = `
	      <td>${index + 1}</td>
	      <td>${task.description}</td>
	      <td>${task.person}</td>
	      <td>${task.department}</td>
	      <td>${task.start_date || "-"}</td>
	      <td>${task.end_date || "-"}</td>
	      <td>${task.priority}</td>	     
	      <td>${task.status}</td>
	      <td>${task.bottlenecks}</td>
	      <td>${task.remarks || "-"}</td>
	    `;
	    tbody.appendChild(row);
	  });

	  // Initialize DataTable only once per table
	  if (!$.fn.DataTable.isDataTable(`#${tableId}`)) {
	    $(`#${tableId}`).DataTable({
	      ordering: false,
	      pageLength: 5,
	      lengthChange: false,
	      searching: false,
	      info: false
	    });
	  } else {
	    $(`#${tableId}`).DataTable().clear().destroy();
	    $(`#${tableId}`).DataTable({
	      ordering: false,
	      pageLength: 5,
	      lengthChange: false,
	      searching: false,
	      info: false
	    });
	  }
	}
  
  
   // Open popup
   document.querySelector('.dropdown a[href="#"]').addEventListener('click', function (e) {
     e.preventDefault();
     document.getElementById("addEmployeePopup").style.display = "flex";
   });

   // Close popup
   function closePopup() {
     document.getElementById("addEmployeePopup").style.display = "none";
   }

   // Clear form fields
   function clearForm() {
     document.getElementById("empEmail").value = "";
     document.getElementById("empRole").value = "";
     document.getElementById("empDept").value = "";
   }

// Submit handler
   document.getElementById("addEmployeeForm").addEventListener("submit", function (e) {
     e.preventDefault();

     const email = document.getElementById("empEmail").value.trim();
     const role = document.getElementById("empRole").value.trim();
     const department = document.getElementById("empDept").value.trim();

     // Validate email domain
     if (!email.endsWith("@resustainability.com")) {
       showToast('info','<i class="fas fa-info" style="color: blue;"></i> Info','Please use a valid company email (e.g., yourname@resustainability.com)');
       clearForm();
       return;
     }

     const newEmployee = { email, role, department };

     fetch("/api/manager/addEmployee", {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify(newEmployee)
     })
     .then(response => response.text())
     .then(message => {
       const msg = message.toLowerCase();

       if (msg.includes("saved")) {
         showToast("success",'<i class="fas fa-check" style="color: green;"></i> Success!','Employee Added Successfully.');
         closePopup();
         clearForm();
         setTimeout(() => location.reload(), 1500);
       } else if (msg.includes("exists")) {
         showToast('info','<i class="fas fa-info" style="color: blue;"></i> Info','Employee Already Exists');
         clearForm();
       } else {
         showToast('error', '<i class="fas fa-xmark" style="color: red; "></i> Failed', 'Failed To Add Employee');
       }
     })
     .catch(error => {
       console.error("Error adding employee:", error);
       showToast('error', '<i class="fas fa-xmark" style="color: red; "></i>  Error', 'Something went wrong while adding employee');
     });
   });

  </script>
</body>
</html>