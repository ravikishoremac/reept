<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Employee_Home_Ept</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
  

  <style>
    * {
      box-sizing: border-box;
    }

     body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f7f9fc;
      display: flex;
      flex-direction: column;
    } 
    
    
 .custom-header {
  background: linear-gradient(90deg, #77c1c9 0%, #7ce7508c 100%);
  padding: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 0.1rem;
  position: relative;
}  
    
  /*   header {
      background-color: #eae6ff;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }  
      */
      
/*     header h2 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: bold;
    }
 */
  /*   header a {
      color: #1e40af;
      text-decoration: none;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
 */
    .main-content {
      flex: 1;
      padding: 20px;
      padding-bottom: 70px;
    }

    .dashboard-header {
      display: flex;
      justify-content: flex-end;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
    }

    .dashboard-header button {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-primary {
      background-color: #2962ff;
      color: #fff;
      border: none;
    }

    .btn-outline {
      background-color: #fff;
      color: #000;
      border: 1px solid #ccc;
    }

    .tasks {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    
    .task-card {
  background: #fff;
  border-left: 6px solid #ffff;
  padding: 13px 4px 12px 4px;
  border-radius: 10px;
  min-width: 0;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.task-card h3 {
  font-size: 1rem;      
  margin: 0 0 6px 0;
  font-weight: 600;
}

.task-card i {
  font-size: 1.1rem;   
  display: block;
  margin-bottom: 3px;
}


.task-card:hover,
.task-card.green:hover,
.task-card.orange:hover,
.task-card.red:hover {
  box-shadow: 0 4px 16px rgb(13 110 253 / 61%);
}

.task-card {
  font-size: 0.95rem;   
}

    .summary-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .progress-section,
    .chart-section {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      flex: 1;
    }

    .progress-bar {
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar-inner {
      background: #007bff;
      height: 10px;
    }

    #taskChart {
      max-width: 140px;
      max-height: 140px;
      margin: auto;
      display: block;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: #fff;
      display: flex;
      justify-content: space-around;
      border-top: 1px solid #ccc;
      padding: 10px 0;
      z-index: 1000;
    }

    .bottom-nav a {
      text-align: center;
      color: #333;
      text-decoration: none;
      font-size: 12px;
    }

    .bottom-nav i {
      font-size: 20px;
      display: block;
      margin-bottom: 4px;
    }

    .bottom-nav a:hover {
      color: #007bff;
      transform: scale(1.1);
    }

    @media (min-width: 768px) {
      .summary-section {
        flex-direction: row;
      }
    }

    @media (max-width: 600px) {
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .dashboard-header button {
        width: 100%;
        box-sizing: border-box;
      }
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 800px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .form-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      gap: 10px;
    }

    .form-row.full-width {
      display: block;
    }

    .form-group {
      flex: 1;
      min-width: 0;
    }

    .form-group.empty {
      flex: 1;
      visibility: hidden;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .form-group textarea {
      resize: vertical;
    }

    .suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .popup-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: -17px;
      width: 15rem;
      margin-left: 15rem;
    }

    .btn-submit,
    .btn-back {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-submit {
      background: #007bff;
      color: #fff;
    }

    .btn-back {
      background: #dc3545;
      color: #fff;
    }

    .popup-form input,
    .popup-form select,
    .popup-form textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .popup-buttons {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .popup-buttons button {
      flex: 1;
    }

    .popup-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .btn-submit {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .btn-submit:hover {
      background-color:rgb(63 61 167 / 88%);
    }

    .btn-back {
      background-color: #424242;
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .btn-back:hover {
      background-color:#da0d14;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      flex: 1 1 100%;
    }

    input, select, textarea {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 4px;
      box-sizing: border-box;
    }

    label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .popup-buttons {
      display: flex;
      justify-content: flex-start;
      gap: 15px;
      margin-top: 20px;
    }

    .btn-submit, .btn-back {
      padding: 10px 20px;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-submit {
      background-color:#007bff;
      color: #fff;
    }

    .btn-back {
      background-color:#f15a2d;
      color: #fff;
    }

    @media (max-width: 600px) {
      .form-row {
        flex-direction: column;
      }
    }
    .profile-container {
      position: relative;
    }

    .profile-icon {
      color: #1e40af;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 38px;
      background: #fff;
      min-width: 150px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.23);
      border-radius: 10px;
      z-index: 2000;
      overflow: hidden;
      animation: fadeIn 0.18s;
    }

    .dropdown.active {
      display: block;
    }

    .dropdown a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.2rem;
      color: #1e40af;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.2s;
    }

    .dropdown a:hover {
      background: #e0e7ff;
    }

    .dropdown a i {
      font-size: 1rem;
    }

      .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .toast {
      position: relative;
      min-width: 250px;
      max-width: 350px;
      background-color: white;
      color: #333;
      padding: 12px 40px 12px 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      animation: fadeInOut 5s forwards;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 0.9rem;
      line-height: 1.4;
      border-left: 4px solid transparent;
    }

    .toast.success {
      border-left-color: #4caf50;
    }

    .toast.error {
      border-left-color: #f44336;
    }

    .toast.info {
      border-left-color: #2196f3;
    }

    .toast-title {
      font-weight: bold;
      margin-bottom: 2px;
      color: #333;
    }

    .toast-message {
      color: #666;
    }

    .toast-close {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1rem;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-20px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }
    
    
    
 .status-legend {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 5px;
  margin-top: 10px;
}

.legend-item {
  display: flex;
  align-items: center;
  font-size: 14px;
  color: #333;
}

.legend-color {
  width: 14px;
  height: 14px;
  border-radius: 3px;
  display: inline-block;
  margin-right: 8px;
}

.legend-color.completed {
  background-color: #15803d; /* green */
}

.legend-color.in-progress {
  background-color: #facc15; /* yellow */
}

.legend-color.not-started {
  background-color: #e5e7eb; /* gray */
}
    
    
    
    
    
    
     @media (max-width: 600px) {
  .dashboard-header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 6px;
    padding: 0 4px;
  }
  .dashboard-header button,
  .dashboard-header a button {
    flex: 1 1 0;
    min-width: 0;
    padding: 6px 2px;
    font-size: 12px;
    white-space: nowrap;
  }
  .dashboard-header i {
    margin-right: 3px !important;
    font-size: 14px;
  }
  /* Remove extra margin for icons if needed */
}


/* Default (Web & Desktop) */
.add-task-btn {
  background-color: #90caf9;
  color: #fff;
  border: none;
}
.view-tasks-btn {
  background-color: #ff9c07;
  color: #fff;
  border: none;
}
.performance-btn {
  background-color: #f2f538;
  color: #212529;
  border: none;
}
.btn-outline.performance-btn {
  border: 1px solid #f2f538;
}

/* Optional: Hover effects */
.add-task-btn:hover { background-color: #90caf9; }
.view-tasks-btn:hover { background-color: #ff9c07; }
.performance-btn:hover { background-color: #f2f538; }

/* Mobile-specific styles */
@media (max-width: 600px) {
  .dashboard-header {
    flex-direction: row;
    gap: 4px;
    padding: 0 2px;
  }
  .dashboard-header button,
  .dashboard-header a button {
    font-size: 12px;
    padding: 6px 2px;
  }
  /* Optional: tweak colors for mobile if needed */
  .add-task-btn { background-color: #90caf9; }
  .view-tasks-btn { background-color: #ff9c07; }
  .performance-btn { background-color: #f2f538; }
}
    
    @media (max-width: 600px) {
  #taskForm {
    max-width: 100vw;
    padding: 10px 2vw;
    box-sizing: border-box;
    overflow-x: hidden;
  }
  .form-row {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin: 0;
    width: 100%;
  }
  .form-group {
    width: 100%;
    margin-bottom: 12px;
  }
  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    font-size: 15px;
    box-sizing: border-box;
  }
  .popup-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
  }
  .btn-submit, .btn-back {
    width: 100%;
    font-size: 16px;
  }
}
    

.custom-menu-bar {
  background: #fff;
  margin: 18px 26px 20px 26px;
  border-radius: 12px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  padding: 0.4rem 2.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  min-height: 54px;
  position: relative;
  z-index: 10;
}
.custom-menu-bar .menu-bar-left ul {
  display: flex;
  gap: 24px;
  margin: 0;
  padding: 0;
  align-items: center;
  list-style: none;
}
.custom-menu-bar li {
  position: relative;
  display: flex;
  align-items: center;
}
.custom-menu-bar a {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 500;
  color: #61677c;
  font-size: 1.07rem;
  text-decoration: none;
  padding: 7px 18px;
  border-radius: 8px;
  transition: background 0.1s, color 0.1s, box-shadow 0.16s;
}
.custom-menu-bar li.active > a,
.custom-menu-bar a:hover {
  background: linear-gradient(90deg, #46e45a 0%, #3ad17e 100%);
  color: #fff !important;
  box-shadow: 0 2px 10px rgba(72,255,134,0.11);
}
.custom-menu-bar i {
  font-size: 1rem;
  color: #dfd55f;
}
.custom-menu-bar .fa-chevron-down {
  font-size: 0.88em;
  margin-left: 4px;
}
.custom-menu-bar .has-dropdown .dropdown-menu {
  display: none;
  position: absolute;
  top: 105%;
  left: 0;
  background: #fff;
  min-width: 180px;
  border-radius: 10px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.10);
  z-index: 20;
  padding: 0.5rem 0;
}
.custom-menu-bar .has-dropdown.open .dropdown-menu {
  display: block;
}
.custom-menu-bar .dropdown-menu li {
  width: 100%;
}
.custom-menu-bar .dropdown-menu a {
  color: #4a5568;
  background: none;
  font-size: 0.99rem;
  padding: 9px 22px;
  border-radius: 0;
}
.custom-menu-bar .dropdown-menu a:hover {
  background: #eeee;
  color: #1e40af;
}
.raise-incident-btn {
 background: #ff9c07ba;
    color: #fff;
    font-weight: bold;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    padding: 6px 10px 7px 8px;
    box-shadow: 0 2px 18px 0 #ff9c07a6;
    cursor: pointer;
    letter-spacing: 0.03em;
    position: relative;
    transition: background 0.15s, box-shadow 0.15s;
    margin-left: 10px;
    display: flex
;
    align-items: center;
    gap: 8px;
}
.raise-incident-btn:hover,
.raise-incident-btn:focus {
background: #ff9c07ba;
    box-shadow: 0 4px 24px 0 #28a745;
}
.badge-new {
position: absolute;
    top: -7px;
    right: -7px;
    background: #90caf9c2;
    color: #fff;
    font-size: 0.5rem;
    font-weight: 700;
    border-radius: 8px;
    padding: 1px 5px;
    box-shadow: 0 2px 7px #90caf985;
    z-index: 1;
    letter-spacing: 0.01em;
}

@media (max-width: 900px) {
  .custom-menu-bar {
    padding: 0.4rem 0.8rem;
  }
  .custom-menu-bar .menu-bar-left ul {
    gap: 8px;
  }
}
@media (max-width: 600px) {
  .custom-menu-bar {
    flex-direction: column;
    align-items: stretch;
    padding: 0.4rem 0.2rem;
    margin: 8px 2px 10px 2px;
    min-height: 46px;
    border-radius: 7px;
    width: 90%;
    margin-left: 19px;
  }
  .custom-menu-bar .menu-bar-left ul {
    gap: 2px;
  }
  .raise-incident-btn {
    font-size: 0.99rem;
    padding: 10px 12px;
    margin: 8px 0 0 18px;
  }
}
 
 
 .header {
    background: linear-gradient(90deg, #77c1c9 0%, #7ce7508c 100%);
    padding: 1rem -0.5rem;
    display: flex
;
    justify-content: space-between;
    align-items: center;
    margin-top: -0.9rem;
    position: relative;
    box-shadow: 0 2px 10px rgba(60, 120, 200, 0.08);
    width: 85rem;
    margin-left: -1rem;
}

   header,
header * {
  color: #fff !important;           
  font-weight: bold !important;    
  font-size: medium !important;      
} 
 
.dropdown a,
.dropdown a i {
  color: #111 !important;
} 
 
    .chart-blink-wrap {
  display: inline-block;
  position: relative;
  /* Adjust if your icon size is not 1em */
  font-size: inherit;
  width: 1em;
  height: 1em;
}

.chart-blink-wrap .fa-chart-simple {
  position: relative;
  z-index: 1;
  color: #61677c; 
}

/* Overlay blinking bars */
.chart-blink-bar {
  position: absolute;
  bottom: 0.16em; 
  width: 0.16em;
  height: 0.45em;
  border-radius: 0.08em;
  opacity: 0;
  z-index: 2;
  pointer-events: none;
  background: #ffff;
  
}

.chart-blink-bar.bar1 {
  left: 0.08em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0s;
}
.chart-blink-bar.bar2 {
  left: 0.32em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0.4s;
}
.chart-blink-bar.bar3 {
  left: 0.60em;
  animation: blinkBarColor 1.5s infinite;
  animation-delay: 0.8s;
}

@keyframes blinkBarColor {
  0%, 100% { opacity: 0; }
  10%, 60% { opacity: 0.9; }
  61%, 99% { opacity: 0; }
}
 
 
 .fa-color-list {
  animation: color-list 1.6s linear infinite;
}
@keyframes color-list {
  0%   { color: #1e40af; }
  25%  { color: #39c08f; }
  50%  { color: #f5cd19; }
  75%  { color: #e53935; }
  100% { color: #1e40af; }
}   
    
  .summary-section-cards {
  display: flex;
  gap: 26px;
  flex-wrap: wrap;
  margin: 2rem 0 1.5rem 0;
  justify-content: center;
}
.metric-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(30,64,175,0.09);
  padding: 1.5rem 1.3rem 1.2rem 1.3rem;
  width: 172px;
  min-width: 192px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: transform .13s, box-shadow .13s;
  height:auto;
  padding:1rem;
   overflow: visible; 
}
.metric-card:hover {
  transform: translateY(-4px) scale(1.04);
  box-shadow: 0 10px 28px rgba(30,64,175,0.14);
}
.metric-icon {
  width: 44px;
  height: 44px;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  font-size: 1.6rem;
  margin: 0 auto 0.5rem auto;
  box-shadow: 0 2px 8px rgba(30,64,175,0.09);
}
.metric-label {
  font-size: 1.06rem;
  font-weight: 500;
  color: #1e40af;
  margin-bottom: .4rem;
}
.metric-value {
  font-size: 1.08rem;
  font-weight: bold;
  color: #222a3a;
  margin-top: .5rem;
}
.progress-bar {
  width: 90%;
  height: 12px;
  background: #edf2f7;
  border-radius: 7px;
  margin: 0.5rem auto 0.2rem auto;
  overflow: hidden;
}
.progress-bar-inner {
  height: 100%;
  border-radius: 7px;
  background: linear-gradient(90deg, #f6d365 0%, #fda085 100%);
  transition: width .5s cubic-bezier(.4,1,.7,1.1);
}
@media (max-width: 900px) {
  .summary-section-cards { flex-wrap: wrap; }
  .metric-card { width: 98vw; min-width: unset; margin-bottom: 1rem;}
}
@media (max-width: 600px) {
  .summary-section-cards { flex-direction: column; gap: 18px;}
  .metric-card { width: 90vw; min-width: unset; }
}  

.metric-card {
      min-height: 270px !important;
    }

    /* Make the chart slightly larger for better legend fit */
    #taskChart {
      max-width: 110px;
      max-height: 110px;
      margin: auto;
      display: block;
    }
    /* Smaller legend font for tight spaces */
    @media (max-width: 400px) {
      .metric-card {
        min-height: 230px !important;
      }
    }
    /* Custom legend for fallback (hidden by default) */
    .custom-legend {
      display: none;
      margin-top: 0.3em;
      font-size: 0.95em;
      text-align: left;
    }
    .custom-legend span {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 4px;
      border-radius: 3px;
      vertical-align: middle;
    }
    
    
    
 @media (max-width: 600px) {
  .popup-form {
    width: 95vw !important;
    padding: 14px 10px !important;
    border-radius: 10px;
    margin: 10px auto;
    overflow-y: auto;
    max-height: 90vh;
  }

  .form-row {
    flex-direction: column;
    gap: 0px; 
  }

  .form-group {
    width: 100% !important;
    margin-left: 0 !important;
    margin-bottom: 8px;
  }

  .form-group textarea,
  .form-group input,
  .form-group select {
    font-size: 14px;
    padding: 10px 8px;
  }

  .popup-buttons {
    flex-direction: row !important;
    justify-content: space-between;
    width: 100%;
    gap: 8px;
    margin-left: 0 !important;
    margin-top: 8px;
  }

  .popup-buttons button {
    flex: 1;
    font-size: 16px;
  }

  #remarks,
  #manager_name {
    width: 100% !important;
  }
}

    

  </style>
</head>
<body>

<div id="toast-container" class="toast-container"></div>
<!--    <header style="background: linear-gradient(90deg, #77c1c9 0%, #7ce7508c 100%);padding: 1rem;display: flex;justify-content: space-between;align-items: center;margin-top: 0.1rem;position: relative;"> 
 --> 
 
  <header class="custom-header">
  <div style="display: flex; align-items: center; gap: 0.5rem;">
    <img src="/images/logo.png" alt="User Icon" style="width: 42px; height: 30px;">
    <i class="fa-solid fa-user-tie" style="color: #1e40af; font-size: 1.2rem;"></i>  
    <span id="loggedInEmail" style="font-weight: normal;"></span>
  </div> 
       <a href="javascript:void(0);" id="notificationIcon" title="Notifications" style="color: #1e40af; font-size: 1.4rem; position: relative;"> </a> 

    <div class="profile-container">
       <!-- <i class="fas fa-user profile-icon" onclick="toggleDropdown()"></i>  -->
       <i class="fa fa-bars" onclick="toggleDropdown()"></i> 
      <div class="dropdown" id="profileDropdown">
        <a href="/ept/profile"><i class="fas fa-user"></i> Profile</a>
        <a href="/" onclick="localStorage.clear();"><i class="fas fa-power-off"></i> Logout</a>
      </div>
    </div> 
</header>
 <nav class="custom-menu-bar">
  <div class="menu-bar-left">
    <ul>
       <li class="has-dropdown" id="dashboardMenu">
        <a href="#" id="dashboardMenuLink">
          <i class="fa-solid fa-chart-simple"></i>
          Dashboard
          <i class="fa-solid fa-chevron-down chevron-icon"></i>
        </a>
        <ul class="dropdown-menu">
          <li><a href="#"><i class="fa-solid fa-gauge"></i> Main Dashboard</a></li>
          <li><a href="/ept/Pdashboard"><i class="fa-solid fa-chart-line"></i> Analytics</a></li>
        </ul>
      </li>
      <li>
        <a href="/ept/emptasklist">
          <i class="fa-solid fa-list-check fa-color-list"></i>
          View Task List
        </a>
      </li>
    </ul>
  </div>
 <div class="menu-bar-right">
    <div style="position: relative; display: inline-block;">
      <button class="raise-incident-btn" onclick="openTaskPopup()">
        + AddTask
      </button>
      <span class="badge-new">New</span>
    </div>
  </div>
</nav>

<main class="main-content">
  <div class="tasks">
    <div class="task-card">
      <h3 id="totalTasks">0</h3>
      <i class="fa-solid fa-clipboard-check fa-bounce"></i> Team Tasks
    </div>
    <div class="task-card green">
      <h3 id="completedTasks">0</h3>
      <i class="fas fa-check fa-bounce"></i> Completed Tasks
    </div>
    <div class="task-card orange">
      <h3 id="InProgressTasks">0</h3>
      <i class="fas fa-clock fa-spin"></i> In Progress
    </div>
    <div class="task-card red">
      <h3 id="notStartedTasks">0</h3>
      <i class="fas fa-hourglass-half fa-spin"></i> Not Started
    </div>
  </div>

<div class="summary-section-cards">
  <div class="metric-card">
    <div class="metric-icon" style="background: linear-gradient(135deg, #4fd1c5 0%, #4299e1 100%);">
      <i class="fa-solid fa-bullseye"></i>
    </div>
    <div class="metric-label">Completion Progress</div>
    <canvas id="completionChart" width="150" height="150"></canvas>
    <div class="metric-value" id="completionLabel">0% Complete</div>
  </div>
  <div class="metric-card">
    <div class="metric-icon" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
      <i class="fa-solid fa-trophy"></i>
    </div>
    <div class="metric-label">Weekly Goals</div>
    <div class="progress-bar gold">
      <div class="progress-bar-inner weekly-goals-bar" id="weeklyGoalsBar" style="width:0%"></div>
    </div>
    <div class="metric-value" id="weeklyGoalsLabel">0% of Weekly Goals</div>
  </div>
 <div class="metric-card">
      <div class="metric-icon" style="background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);">
        <i class="fa-solid fa-chart-pie"></i>
      </div>
      <div class="metric-label">Task Status Breakdown</div>
      <canvas id="taskChart" width="110" height="110"></canvas>
      
      <div class="status-legend">
  <div class="legend-item">
    <span class="legend-color completed"></span>
    <span class="legend-label">Completed</span>
  </div>
  <div class="legend-item">
    <span class="legend-color in-progress"></span>
    <span class="legend-label">In Progress</span>
  </div>
  <div class="legend-item">
    <span class="legend-color not-started"></span>
    <span class="legend-label">Not Started</span>
  </div>
</div>
</div>

 

  
</div>
</main>
<div id="addTaskPopup" class="popup-overlay" style="display: none;">
  <div class="popup-form">
    <h3>Add New Task</h3>
    <form id="taskForm">
      <div class="form-row">
        <div class="form-group">
          <label for="description">Description:</label>
          <input type="text" id="description" name="description" placeholder="Enter description" required>
        </div>
         <div class="form-group">
            <label for="department">Department:</label>            
            <input type="text" id="department" name="department" readonly >
          </div>
        <div class="form-group">
          <label for="area">Area:</label>
          <input type="text" id="area" name="area" placeholder="Enter area" >
        </div>
        </div>
        <div class="form-row">
        <div class="form-group">
          <label for="sub_area">Sub-Area:</label>
          <input type="text" id="sub_area" name="sub_area" placeholder="Enter sub-area" >
        </div>
        <div class="form-group">
          <label for="priority">Priority:</label>
          <select id="priority" name="priority" required>
            <option value="">Select Priority</option>
            <option>High</option>
            <option>Medium</option> 
            <option>Low</option>
          </select>
        </div>
        
        <div class="form-group" style="position: relative;">
          <label for="person">Person:</label>
          <input type="text" id="person" name="person" placeholder="Enter Your MailId" autocomplete="off" readonly>

        </div>
        </div>
        
        <div class="form-row">
        <div class="form-group">
          <label for="start_date">Start-Date:</label>
          <input type="date" id="start_date" name="start_date" required>
        </div>
        <div class="form-group">
          <label for="end_date">End-Date:</label>
          <input type="date" id="end_date" name="end_date" required>
        </div>
      
      
        <div class="form-group">
          <label for="status">Status:</label>
          <!-- <select id="status" name="status" required>
            <option value="">Select Status</option>
            <option>Not Started</option>
          </select> -->
          <input type="text" id="status" name="status" value="Not Started" readonly required>
        </div>
        </div>
         
         <div class="form-row">                 
         <div class="form-group">
          <label for="manager_name">Manager:</label>
          <input type="text" id="manager_name" name="manager_name" style=" width: 15rem;" readonly>  </div>
          
        <div class="form-group" style=" margin-left: -16rem;">
          <label for="remarks">Remarks:</label>
          <textarea id="remarks" name="remarks"placeholder="Additional remarks&#10;Note: Don't add too much content here." rows="3"></textarea>
        </div>
      </div>
      <div class="form-row">
      <div class="popup-buttons">
        <!-- <button type="submit" class="btn-submit" onclick="submitTask(event)">Submit</button> -->
        <button type="submit" class="btn-submit" id="submitTaskBtn" onclick="submitTask(event)">Add</button>
        <button type="button" class="btn-back" onclick="closeTaskPopup()">&laquo; Cancel</button>
      </div>
      </div>
    </form>
  </div>
</div>

<script>

function showToast(type, title, message) {
  const toastContainer = document.getElementById("toast-container");
  const toast = document.createElement("div");
  toast.className = `toast ${type}`;
  const toastTitle = document.createElement("div");
  toastTitle.className = "toast-title";
  //toastTitle.textContent = title;
  toastTitle.innerHTML = title;
  const toastMessage = document.createElement("div");
  toastMessage.className = "toast-message";
  toastMessage.textContent = message;
  const closeButton = document.createElement("button");
  closeButton.className = "toast-close";
  //closeButton.textContent = "×";
  closeButton.innerHTML = '<i class="fas fa-times"></i>';
  closeButton.onclick = () => {
    toast.style.animation = "none";
    toast.remove();
  };
  toast.appendChild(toastTitle);
  toast.appendChild(toastMessage);
  toast.appendChild(closeButton);
  toastContainer.appendChild(toast);
  setTimeout(() => {
    if (toast.parentNode) {
      toast.remove();
    }
  }, 5000);
}


document.getElementById('dashboardMenuLink').addEventListener('click', function (e) {
	  e.preventDefault();
	  const dropdown = document.querySelector('#dashboardMenu .dropdown-menu');
	  dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
	});
 
 let tasksInfo = [];
 let taskChart = null;
 let completionChart = null;

 // Initialize circular completion chart and Task Status Breakdown chart
 window.addEventListener("DOMContentLoaded", function() {
   completionChart = new Chart(document.getElementById('completionChart').getContext('2d'), {
     type: 'doughnut',
     data: {
       datasets: [{
         data: [0, 100],
         backgroundColor: ['#4299e1', '#f0f4f8'],
         borderWidth: 0,
         cutout: '80%'
       }]
     },
     options: {
       plugins: { legend: { display: false } },
       tooltips: { enabled: false },
       animation: { animateRotate: true, duration: 1000 }
     }
   });

   // Main fix: legend at bottom, smaller font for legend, larger canvas
   taskChart = new Chart(document.getElementById('taskChart').getContext('2d'), {
     type: 'doughnut',
     data: {
       labels: ['Completed', 'In Progress', 'Not Started'],
       datasets: [{
         data: [0, 0, 0],
         backgroundColor: ['#28a745', '#ffc107', '#e0e0e0'],
         borderWidth: 1
       }]
     },
     options: {
    	  responsive: true,
    	  maintainAspectRatio: false,
    	  plugins: {
    	    legend: {
    	    	display:false,
    	      position: 'bottom',
    	      labels: {
    	        color: '#333',
    	        boxWidth: 15,
    	        font: {
    	          size: 12
    	        },
    	        generateLabels: function(chart) {
    	          const data = chart.data;
    	          return data.labels.map((label, i) => ({
    	            text: label,
    	            fillStyle: data.datasets[0].backgroundColor[i],
    	            hidden: false,
    	            index: i
    	          }));
    	        }
    	      }
    	    },
    	    tooltip: {
    	      enabled: true,
    	      boxPadding: 8
    	    }
    	  },
    	  layout: {
    	    padding: 10
    	  }
    	}
  
   });

   // Show fallback legend if legend isn't rendered (for very small screens)
   setTimeout(function() {
     const legendBox = document.querySelector('.metric-card .custom-legend');
     const chartLegend = document.querySelector('.metric-card .chartjs-render-monitor + div');
     if (!chartLegend || chartLegend.textContent.trim().length < 5) {
       legendBox.style.display = 'block';
     }
   }, 700);

   startAutoRefresh();
 });

 async function fetchTasks() {
   try {
     const response = await fetch(`/api/employee/tasks/${localStorage.getItem("EmpEmail")}`);
     if (!response.ok) throw new Error('Failed to fetch tasks');

     tasksInfo = await response.json();

     // Compute statistics
     const totalTasks = tasksInfo.length;
     const completedTasks = tasksInfo.filter(task => task.status === "Completed").length;
     const notStartedTasks = tasksInfo.filter(task => task.status === "Not Started").length;
     const inProgressTasks = tasksInfo.filter(task => task.status === "In Progress").length;

     // Calculate weekly goals
     const today = new Date();
     const startOfWeek = new Date(today);
     startOfWeek.setDate(today.getDate() - today.getDay()); // Start of current week (Sunday)
     startOfWeek.setHours(0, 0, 0, 0);
     const endOfWeek = new Date(startOfWeek);
     endOfWeek.setDate(startOfWeek.getDate() + 6); // End of current week (Saturday)
     endOfWeek.setHours(23, 59, 59, 999);

     const weeklyTasks = tasksInfo.filter(task => {
       const taskStartDate = new Date(task.start_date);
       return taskStartDate >= startOfWeek && taskStartDate <= endOfWeek;
     });
     const weeklyTotalTasks = weeklyTasks.length;
     const weeklyCompletedTasks = weeklyTasks.filter(task => task.status === "Completed").length;
     const weeklyCompletionPercentage = weeklyTotalTasks > 0 ? (weeklyCompletedTasks / weeklyTotalTasks) * 100 : 0;

     // Update main dashboard cards
     document.getElementById("totalTasks").textContent = totalTasks;
     document.getElementById("completedTasks").textContent = completedTasks;
     document.getElementById("notStartedTasks").textContent = notStartedTasks;
     document.getElementById("InProgressTasks").textContent = inProgressTasks;

     // Update the new summary cards
     // Completion Progress (circular)
     const completionPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
     if (completionChart) {
       completionChart.data.datasets[0].data = [completionPercentage, 100 - completionPercentage];
       completionChart.update();
     }
     document.getElementById('completionLabel').textContent = `${completionPercentage.toFixed(1)}% Complete`;

     // Weekly Goals (bar)
     document.getElementById('weeklyGoalsBar').style.width = `${weeklyCompletionPercentage}%`;
     document.getElementById('weeklyGoalsLabel').textContent = `${weeklyCompletionPercentage.toFixed(1)}% of Weekly Goals`;

     // Task Status Breakdown
     if (taskChart) {
       taskChart.data.datasets[0].data = [completedTasks, inProgressTasks, notStartedTasks];
       taskChart.update();
     }

   } catch (error) {
     console.error("Error fetching tasks:", error);
     tasksInfo = [];
   }
 }

 
function startAutoRefresh() {
  fetchTasks();
  setInterval(fetchTasks, 5000);
}

startAutoRefresh();

// Function to display the logged-in email
function displayLoggedInEmail() {
  const loggedInEmail = localStorage.getItem("EmpEmail") || "Unknown User";
  document.getElementById("loggedInEmail").textContent = loggedInEmail;
}

// Call the function to display the email when the page loads
displayLoggedInEmail();


function renderNotifications() {
  const list = document.getElementById("notificationList");
  const badge = document.getElementById("notificationCount");
  const empty = document.getElementById("notificationEmpty");
  list.innerHTML = "";

  let unreadCount = notifications.filter(n => n.unread).length;
  badge.textContent = unreadCount > 0 ? unreadCount : "";
  badge.style.display = unreadCount > 0 ? "block" : "none";

  if (notifications.length === 0) {
    empty.style.display = "";
    list.style.display = "none";
  } else {
    empty.style.display = "none";
    list.style.display = "";
    notifications.forEach(n => {
      const li = document.createElement("li");
      li.className = "notification-item" + (n.unread ? " unread" : "");
      li.innerHTML = `<i class="fa-solid ${n.icon}"></i>
        <span>
          ${n.message}
          <span class="notification-time">${n.time}</span>
        </span>`;
      list.appendChild(li);
    });
  }
}

const notificationIcon = document.getElementById("notificationIcon");
const notificationDropdown = document.getElementById("notificationDropdown");
let notificationDropdownOpen = false;

notificationIcon.addEventListener("click", function(e) {
  e.stopPropagation();
  notificationDropdownOpen = !notificationDropdownOpen;
  notificationDropdown.classList.toggle("visible", notificationDropdownOpen);
  if (notificationDropdownOpen) {
    notifications.forEach(n => n.unread = false);
    renderNotifications();
  }
});
 
let profileDropdownOpen = false;

function toggleDropdown() {
  const dropdown = document.getElementById("profileDropdown");
  profileDropdownOpen = !profileDropdownOpen;
  dropdown.classList.toggle("active", profileDropdownOpen);
}

window.addEventListener("click", function(e) {
  if (notificationDropdownOpen &&
      !notificationDropdown.contains(e.target) &&
      !notificationIcon.contains(e.target)) {
    notificationDropdown.classList.remove("visible");
    notificationDropdownOpen = false;
  }

  const profileContainer = document.querySelector(".profile-container");
  if (profileDropdownOpen &&
      !profileContainer.contains(e.target)) {
    const dropdown = document.getElementById("profileDropdown");
    dropdown.classList.remove("active");
    profileDropdownOpen = false;
  }

  const taskPopup = document.getElementById('addTaskPopup');
  if (taskPopup.style.display === 'flex' && e.target === taskPopup) {
    closeTaskPopup();
  }
});

renderNotifications();

const ctx = document.getElementById('taskChart').getContext('2d');
taskChart = new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Completed', 'In Progress', 'Not Started'],
    datasets: [{
      data: [0, 0, 0],
      backgroundColor: ['#28a745', '#ffc107', '#e0e0e0'],
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      tooltip: {
        callbacks: {
          label: function(context) {
            const total = context.dataset.data.reduce((a, b) => a + b, 0);
            const value = context.raw;
            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
            return `${context.label}: ${value} (${percentage}%)`;
          }
        }
      }
    }
  }
});

 async function openTaskPopup() {
	  const popup = document.getElementById('addTaskPopup');
	  popup.style.display = 'flex';

	  const empEmail = localStorage.getItem('EmpEmail');

	  if (empEmail) {
	    document.getElementById('person').value = empEmail;

	    try {
	      const response = await fetch(`/api/users/by-email/${encodeURIComponent(empEmail)}`);
	      if (!response.ok) throw new Error('User not found');

	      const user = await response.json();


	      document.getElementById('department').value = user.department || '';


	      document.getElementById('manager_name').value = user.reportingto || 'N/A';

	    } catch (err) {
	      console.error('Failed to load user details:', err);
	      showToast('error', '<i class="fas fa-xmark" style="color: red;"></i> Error', 'Unable to fetch employee details');
	      

	      document.getElementById('department').value = '';
	      document.getElementById('manager_name').value = '';
	    }
	  }
	}

	function closeTaskPopup() {
		  document.getElementById('addTaskPopup').style.display = 'none';
		}
	

 async function submitTask(event) {
	  event.preventDefault();

	  const form = document.getElementById('taskForm');
	  const submitBtn = event.target;

	  if (!form.checkValidity()) {
	    form.reportValidity();
	    return;
	  }

	  // Email validation
	  const personEmail = document.getElementById('person').value.trim();
	 // const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
	 const emailRegex = /^[^\s@]+@resustainability\.com$/;


	  if (!emailRegex.test(personEmail)) {
	    showToast('error', '<i class="fas fa-xmark" style="color: red; "></i> Invalid Email', 'Please enter a valid email address in "Person" field.');
	    return;
	  }
	  
	  const startDateValue = document.getElementById('start_date').value;
	  const endDateValue = document.getElementById('end_date').value;

	  if (new Date(startDateValue) > new Date(endDateValue)) {
	    showToast( 'error', '<i class="fas fa-xmark" style="color: red;"></i> Invalid Dates','Start date cannot be after end date.' );
	    return;
	  }

	  // Disable button and show loading text
	  submitBtn.disabled = true;
	  const originalText = submitBtn.innerText;
	  submitBtn.innerText = 'Assigning...';

	  const formData = new FormData(form);
	  const taskData = {};
	  formData.forEach((value, key) => {
	    taskData[key] = value;
	  });

	  try {
	    const response = await fetch('/api/manager/taskasign', {
	      method: 'POST',
	      headers: {
	        'Content-Type': 'application/json'
	      },
	      body: JSON.stringify(taskData)
	    });

	    if (!response.ok) {
	      throw new Error('Failed to assign task');
	    }

	    closeTaskPopup();
	    showToast("success",'<i class="fas fa-check" style="color: green;"></i> Success!','Task assigned successfully.');
	    form.reset();
	    await fetchTasks();
	  } catch (error) {
	    console.error('Assignment error:', error);
	    showToast('error', '<i class="fas fa-xmark" style="color: red; "></i>  Failed', 'Failed to assign task');
	  } finally {
	    submitBtn.disabled = false;
	    submitBtn.innerText = originalText;
	  }
	} 


//Add this after the DOM is loaded (before </body> or in a script block)
document.querySelectorAll('.custom-menu-bar li.has-dropdown > a').forEach(function(menuLink) {
  menuLink.addEventListener('click', function(e) {
    e.preventDefault();
    // Close other open dropdowns and reset their chevrons
    document.querySelectorAll('.custom-menu-bar li.has-dropdown').forEach(function(li) {
      if (li !== menuLink.parentElement) {
        li.classList.remove('open');
        const chevron = li.querySelector('.chevron-icon');
        if (chevron) {
          chevron.classList.remove('fa-chevron-up');
          chevron.classList.add('fa-chevron-down');
        }
      }
    });
    // Toggle this dropdown
    menuLink.parentElement.classList.toggle('open');
    const chevron = menuLink.querySelector('.chevron-icon');
    if (chevron) {
      chevron.classList.toggle('fa-chevron-down');
      chevron.classList.toggle('fa-chevron-up');
    }
  });
});

// Optional: close dropdown when clicking outside and reset chevron
document.addEventListener('click', function(e) {
  document.querySelectorAll('.custom-menu-bar li.has-dropdown').forEach(function(li) {
    if (!e.target.closest('.custom-menu-bar li.has-dropdown')) {
      li.classList.remove('open');
      const chevron = li.querySelector('.chevron-icon');
      if (chevron) {
        chevron.classList.remove('fa-chevron-up');
        chevron.classList.add('fa-chevron-down');
      }
    }
  });
});
</script>
</body>
</html>